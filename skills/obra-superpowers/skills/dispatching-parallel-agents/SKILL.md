# 分发并行代理 (Dispatching Parallel Agents)

📦 **仓库**: `yanghao1143/chiclaude-skills`
🔥 **安装量**: 6.1K
🔗 **出处**: https://github.com/yanghao1143/chiclaude-skills

---

## 技能简介

当面临 2+ 个可以独立工作的任务时，分发并行代理来同时处理。

**适用场景**：面临 2+ 个独立任务，可以在没有共享状态或顺序依赖的情况下并行工作。

---

## 核心原则

**核心原则**：每个独立问题域分发一个代理。让它们并发工作。

---

## 何时使用

**使用时机**：
- 3+ 个测试文件失败，原因不同
- 多个子系统独立损坏
- 每个问题可以在不了解其他问题的情况下理解
- 调查之间没有共享状态

**不要使用时机**：
- 失败是相关的（修复一个可能会修复其他）
- 需要了解完整系统状态
- 代理会相互干扰

---

## 模式

### 1. 识别独立域

按损坏内容分组失败：
- 文件 A 测试：工具审批流程
- 文件 B 测试：批量完成行为
- 文件 C 测试：中止功能

每个域是独立的 - 修复工具审批不会影响中止测试。

### 2. 创建专注的代理任务

每个代理获得：
- **特定范围**：一个测试文件或子系统
- **清晰目标**：让这些测试通过
- **约束**：不要更改其他代码
- **预期输出**：你发现和修复的摘要

### 3. 并行分发

```typescript
Task("修复 agent-tool-abort.test.ts 失败")
Task("修复 batch-completion-behavior.test.ts 失败")
Task("修复 tool-approval-race-conditions.test.ts 失败")
// 所有三个并发运行
```

### 4. 审查和整合

当代理返回时：
- 阅读每个摘要
- 验证修复不冲突
- 运行完整测试套件
- 整合所有更改

---

## 代理提示结构

好的代理提示：
1. **专注** - 一个清晰的问题域
2. **自包含** - 理解问题所需的所有上下文
3. **明确输出** - 代理应该返回什么？

```markdown
修复 src/agents/agent-tool-abort.test.ts 中的 3 个失败测试：

1. "should abort tool with partial output capture" - 期望消息中有 'interrupted at'
2. "should handle mixed completed and aborted tools" - 快速工具中止而不是完成
3. "should properly track pendingToolCount" - 期望 3 个结果但得到 0

这些是时序/竞态条件问题。你的任务：

1. 阅读测试文件并理解每个测试验证什么
2. 识别根本原因 - 时序问题还是实际 bug？
3. 通过以下方式修复：
   - 用基于事件的等待替换任意超时
   - 如果发现则修复中止实现中的 bug
   - 如果测试改变了行为则调整测试期望

不要只是增加超时 - 找到真正的问题。

返回：你发现和修复的内容摘要。
```

---

## 常见错误

**❌ 太宽泛**："修复所有测试" - 代理会迷失
**✅ 具体**："修复 agent-tool-abort.test.ts" - 专注的范围

**❌ 无上下文**："修复竞态条件" - 代理不知道在哪里
**✅ 有上下文**：粘贴错误消息和测试名称

---

## 关键好处

1. **并行化** - 多个调查同时发生
2. **专注** - 每个代理范围狭窄，更少上下文需要跟踪
3. **独立性** - 代理不会相互干扰
4. **速度** - 在一个问题的时间内解决三个问题

---

## 相关技能

- **writing-plans**: 编写计划
- **executing-plans**: 执行计划
- **subagent-driven-development**: 子代理驱动开发

---

## 安全检查

✅ 无恶意代码
✅ 无可疑外部URL
✅ 无API密钥或凭证
✅ 内容与技能描述相符
