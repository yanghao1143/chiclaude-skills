# Test-Driven Development - 测试驱动开发

> **原始仓库**: `obra/superpowers/test-driven-development`
> **安装量**: 9.2K
> **翻译日期**: 2026-02-15
> **原文链接**: https://github.com/yanghao1143/chiclaude-skills

---

## 📖 技能简介

先写测试。看它失败。写最小代码使其通过。

**核心原则**：如果你没看到测试失败，你就不知道它测试的是正确的东西。

违反规则的字面意思就是违反规则的精神。

---

## 🎯 何时使用

**始终**：
- 新功能
- Bug 修复
- 重构
- 行为变更

**例外**（询问你的用户）：
- 一次性原型
- 生成的代码
- 配置文件

在想"就这次跳过 TDD"？停止。那是合理化。

---

## ⚠️ 铁律

**没有先失败的测试就不能写生产代码**

在测试之前写代码？删除它。重新开始。

没有例外：
- 不要把它保留为"参考"
- 写测试时不要"适应"它
- 不要看它
- 删除意味着删除

从测试开始重新实现。句号。

---

## 🔴🟢🔵 红-绿-重构

```
[RED 写失败测试] → [验证正确失败] → [GREEN 最小代码] → [验证通过] → [REFACTOR 清理] → [下一个]
```

### RED - 写失败测试

写一个最小测试显示应该发生什么：

```typescript
test('retries failed operations up to 3 times', async () => {
  const result = await retryOperation(operation);
  expect(result).toBe('success');
  expect(attempts).toBe(3);
});
```

要求：
- 一个行为
- 清晰的名称
- 真实代码（除非不可避免，否则不模拟）

### 验证 RED - 看它失败

**强制执行。永不跳过。**

```bash
npm test path/to/test.test.ts
```

确认：
- 测试失败（而非错误）
- 失败消息是预期的
- 因为缺少功能而失败（而非拼写错误）

测试通过？你在测试现有行为。修复测试。
测试错误？修复错误，重新运行直到正确失败。

### GREEN - 最小代码

编写最简单的代码通过测试。

不要添加功能、重构其他代码或"改进"超出测试范围。

### 验证 GREEN - 看它通过

**强制执行。**

```bash
npm test path/to/test.test.ts
```

确认：
- 测试通过
- 其他测试仍然通过
- 输出干净（无错误、警告）

### REFACTOR - 清理

只在绿色之后：
- 删除重复
- 改进名称
- 提取助手

保持测试绿色。不要添加行为。

---

## ✅ 好的测试

| 质量 | 好 | 坏 |
|------|-----|-----|
| 最小 | 一件事。名称中有"和"？拆分它。 | `test('validates email and domain and whitespace')` |
| 清晰 | 名称描述行为 | `test('test1')` |
| 显示意图 | 展示期望的 API | 模糊代码应该做什么 |

---

## 💡 为什么顺序重要

### "我会在之后写测试来验证它有效"

之后写的测试立即通过。立即通过什么也证明不了：
- 可能测试错误的东西
- 可能测试实现，而非行为
- 可能错过你忘记的边缘情况
- 你从未看到它捕获 bug

测试优先强制你看到测试失败，证明它实际上测试了一些东西。

### "我已经手动测试了所有边缘情况"

手动测试是临时的。你认为了解一切但：
- 没有记录你测试了什么
- 代码更改时无法重新运行
- 在压力下容易忘记情况

自动化测试是系统的。它们每次以相同方式运行。

### "删除 X 小时的工作是浪费"

沉没成本谬误。时间已经过去了。你现在的选择：
- 删除并用 TDD 重写（X 更多小时，高信心）
- 保留并在之后添加测试（30 分钟，低信心，可能有 bug）

"浪费"是保留你不能信任的代码。没有真正测试的工作代码是技术债务。

---

## 🚩 危险信号 - 停止并重新开始

- 测试之前有代码
- 实现之后测试
- 测试立即通过
- 无法解释为什么测试失败
- "稍后"添加测试
- 合理化"就这一次"
- "我已经手动测试了"
- "之后的测试达到相同目的"
- "这是精神而非仪式"
- "保留为参考"或"适应现有代码"
- "已经花费 X 小时，删除是浪费"
- "TDD 是教条的，我是务实的"
- "这是不同的，因为..."

**所有这些都意味着**：删除代码。用 TDD 重新开始。

---

## 📋 验证清单

在标记工作完成之前：
- [ ] 每个新函数/方法都有测试
- [ ] 实现前看到每个测试失败
- [ ] 每个测试因预期原因失败（缺少功能，而非拼写错误）
- [ ] 写了最小代码通过每个测试
- [ ] 所有测试通过
- [ ] 输出干净（无错误、警告）
- [ ] 测试使用真实代码（只有在不可避免时才模拟）
- [ ] 边缘情况和错误覆盖

无法勾选所有框？你跳过了 TDD。重新开始。

---

## 🔒 安全检查

此技能不包含任何恶意代码。所有内容均为测试方法论指南。

---

*翻译自: https://github.com/yanghao1143/chiclaude-skills
