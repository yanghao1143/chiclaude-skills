---
name: claude-md-improver
description: 审计和改进仓库中的 CLAUDE.md 文件。当用户要求检查、审计、更新、改进或修复 CLAUDE.md 文件时使用。扫描所有 CLAUDE.md 文件，根据模板评估质量，输出质量报告，然后进行针对性更新。当用户提到"CLAUDE.md 维护"或"项目记忆优化"时也可使用。
tools: Read, Glob, Grep, Bash, Edit
---

# CLAUDE.md 改进器

审计、评估和改进代码库中的 CLAUDE.md 文件，确保 Claude Code 拥有最佳的项目上下文。

**此技能可以写入 CLAUDE.md 文件。** 在展示质量报告并获得用户批准后，它会对 CLAUDE.md 文件进行针对性改进。

## 工作流程

### 阶段 1：发现

在仓库中查找所有 CLAUDE.md 文件：

```bash
find . -name "CLAUDE.md" -o -name ".claude.md" -o -name ".claude.local.md" 2>/dev/null | head -50
```

**文件类型与位置：**

| 类型 | 位置 | 用途 |
|------|----------|---------|
| 项目根目录 | `./CLAUDE.md` | 主要项目上下文（提交到 git，与团队共享） |
| 本地覆盖 | `./.claude.local.md` | 个人/本地设置（gitignored，不共享） |
| 全局默认 | `~/.claude/CLAUDE.md` | 跨所有项目的用户级默认设置 |
| 包特定 | `./packages/*/CLAUDE.md` | monorepo 中的模块级上下文 |
| 子目录 | 任何嵌套位置 | 功能/领域特定上下文 |

**注意：** Claude 会自动发现父目录中的 CLAUDE.md 文件，使 monorepo 设置自动生效。

### 阶段 2：质量评估

对每个 CLAUDE.md 文件，根据质量标准进行评估。详细评分标准请参见 [references/quality-criteria.md](references/quality-criteria.md)。

**快速评估清单：**

| 标准 | 权重 | 检查项 |
|-----------|--------|-------|
| 命令/工作流文档 | 高 | 是否包含构建/测试/部署命令？ |
| 架构清晰度 | 高 | Claude 能否理解代码库结构？ |
| 非显而易见的模式 | 中 | 是否记录了陷阱和特殊之处？ |
| 简洁性 | 中 | 没有冗长的解释或显而易见的信息？ |
| 时效性 | 高 | 是否反映当前代码库状态？ |
| 可操作性 | 高 | 指令是否可执行，而非模糊？ |

**质量评分：**
- **A (90-100)**：全面、时效、可操作
- **B (70-89)**：覆盖良好，有小缺口
- **C (50-69)**：基本信息，缺少关键部分
- **D (30-49)**：稀疏或过时
- **F (0-29)**：缺失或严重过时

### 阶段 3：输出质量报告

**在进行任何更新之前，务必先输出质量报告。**

格式：

```
## CLAUDE.md 质量报告

### 摘要
- 找到的文件数：X
- 平均分数：X/100
- 需要更新的文件数：X

### 逐文件评估

#### 1. ./CLAUDE.md (项目根目录)
**评分：XX/100 (等级：X)**

| 标准 | 分数 | 备注 |
|-----------|-------|-------|
| 命令/工作流 | X/20 | ... |
| 架构清晰度 | X/20 | ... |
| 非显而易见的模式 | X/15 | ... |
| 简洁性 | X/15 | ... |
| 时效性 | X/15 | ... |
| 可操作性 | X/15 | ... |

**问题：**
- [列出具体问题]

**建议添加：**
- [列出应该添加的内容]

#### 2. ./packages/api/CLAUDE.md (包特定)
...
```

### 阶段 4：针对性更新

输出质量报告后，在更新前征求用户确认。

**更新指南（关键）：**

1. **仅提议针对性添加** - 专注于真正有用的信息：
   - 分析期间发现的命令或工作流
   - 在代码中发现的陷阱或非显而易见的模式
   - 不清楚的包关系
   - 有效的测试方法
   - 配置特殊之处

2. **保持最小化** - 避免：
   - 重述代码中显而易见的内容
   - 已经涵盖的通用最佳实践
   - 不太可能再次出现的一次性修复
   - 一句话就能说清楚时的冗长解释

3. **显示差异** - 对于每个更改，显示：
   - 要更新哪个 CLAUDE.md 文件
   - 具体添加内容（作为 diff 或引用块）
   - 简要说明为什么这对未来的会话有帮助

**Diff 格式：**

```markdown
### 更新：./CLAUDE.md

**原因：** 缺少构建命令，导致对如何运行项目产生困惑。

```diff
+ ## 快速开始
+
+ ```bash
+ npm install
+ npm run dev  # 在 3000 端口启动开发服务器
+ ```
```
```

### 阶段 5：应用更新

获得用户批准后，使用 Edit 工具应用更改。保留现有内容结构。

## 模板

按项目类型的 CLAUDE.md 模板请参见 [references/templates.md](references/templates.md)。

## 需要标记的常见问题

1. **过时的命令**：不再有效的构建命令
2. **缺少依赖**：未提及的必需工具
3. **过时的架构**：已更改的文件结构
4. **缺少环境设置**：必需的环境变量或配置
5. **损坏的测试命令**：已更改的测试脚本
6. **未记录的陷阱**：未捕获的非显而易见模式

## 与用户分享的提示

在展示建议时，提醒用户：

- **`#` 快捷键**：在 Claude 会话期间，按 `#` 让 Claude 自动将学习内容整合到 CLAUDE.md 中
- **保持简洁**：CLAUDE.md 应该是人类可读的；密集优于冗长
- **可操作的命令**：所有记录的命令都应该可以直接复制粘贴
- **使用 `.claude.local.md`**：用于不与团队共享的个人偏好（添加到 `.gitignore`）
- **全局默认**：将用户级偏好放在 `~/.claude/CLAUDE.md` 中

## 优秀 CLAUDE.md 的特征

**关键原则：**
- 简洁且人类可读
- 可以复制粘贴的可操作命令
- 项目特定的模式，而非通用建议
- 非显而易见的陷阱和警告

**推荐章节**（仅使用相关的）：
- 命令（构建、测试、开发、lint）
- 架构（目录结构）
- 关键文件（入口点、配置）
- 代码风格（项目约定）
- 环境（必需的变量、设置）
- 测试（命令、模式）
- 陷阱（特殊之处、常见错误）
- 工作流程（何时做什么）

---

*本技能来自 AI Agent 技能生态，由 AI论坛运营中心 汉化*